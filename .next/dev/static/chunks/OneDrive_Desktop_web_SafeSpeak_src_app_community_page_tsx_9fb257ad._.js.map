{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/saksham/OneDrive/Desktop/web/SafeSpeak/src/app/community/page.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useEffect, useMemo, useRef, useState } from \"react\";\nimport { ensureAnon, auth, db } from \"@/lib/firebase\";\nimport {\n  collection,\n  doc,\n  getDoc,\n  setDoc,\n  addDoc,\n  serverTimestamp,\n  query,\n  orderBy,\n  onSnapshot,\n} from \"firebase/firestore\";\n\nconst globalChatId = \"global-support-hub\";\n\nfunction getAnonymousName(uid: string): string {\n  const key = `anonName:${uid}`;\n  const cached = localStorage.getItem(key);\n  if (cached) return cached;\n  // Generate a soft, caring pseudonym\n  const adjectives = [\n    \"Caring\",\n    \"Brave\",\n    \"Kind\",\n    \"Gentle\",\n    \"Hopeful\",\n    \"Calm\",\n    \"Bright\",\n    \"Warm\",\n    \"Quiet\",\n    \"Patient\",\n  ];\n  const nouns = [\n    \"Supporter\",\n    \"Listener\",\n    \"Friend\",\n    \"Ally\",\n    \"Helper\",\n    \"Companion\",\n    \"Neighbor\",\n    \"Buddy\",\n    \"Guardian\",\n    \"Peer\",\n  ];\n  const num = Math.floor(Math.random() * 89) + 11; // 11-99\n  const name = `${\n    adjectives[Math.floor(Math.random() * adjectives.length)]\n  } ${nouns[Math.floor(Math.random() * nouns.length)]} #${num}`;\n  localStorage.setItem(key, name);\n  return name;\n}\n\nexport default function CommunityPage() {\n  const [loading, setLoading] = useState(true);\n  const [messages, setMessages] = useState<Array<{ id: string; senderAnonName: string; body: string; createdAt?: any }>>([]);\n  const [text, setText] = useState(\"\");\n  const [error, setError] = useState<string | null>(null);\n  const scrollerRef = useRef<HTMLDivElement | null>(null);\n\n  // Ensure anonymous auth on mount\n  useEffect(() => {\n    void (async () => {\n      try {\n        setLoading(true);\n        await ensureAnon();\n      } catch (e: any) {\n        // eslint-disable-next-line no-console\n        console.error(e);\n        setError(e?.message || \"Failed to initialize anonymous session\");\n      } finally {\n        setLoading(false);\n      }\n    })();\n  }, []);\n\n  // Subscribe to global messages\n  useEffect(() => {\n    const chatRef = doc(db, \"chats\", globalChatId);\n    const msgsRef = collection(chatRef, \"messages\");\n    const q = query(msgsRef, orderBy(\"createdAt\", \"asc\"));\n    const unsub = onSnapshot(q, (snap) => {\n      const arr: any[] = [];\n      snap.forEach((d) => arr.push({ id: d.id, ...d.data() }));\n      setMessages(arr);\n      // Auto-scroll to bottom\n      requestAnimationFrame(() => {\n        if (scrollerRef.current) {\n          scrollerRef.current.scrollTop = scrollerRef.current.scrollHeight;\n        }\n      });\n    });\n    return () => unsub();\n  }, []);\n\n  async function send() {\n    const body = text.trim();\n    if (!body) return;\n    const user = auth.currentUser || (await ensureAnon());\n    if (!user?.uid) return;\n\n    const chatRef = doc(db, \"chats\", globalChatId);\n    const chatSnap = await getDoc(chatRef);\n    if (!chatSnap.exists()) {\n      await setDoc(chatRef, {\n        participants: [\"global-support-hub\", \"system\"],\n        createdAt: serverTimestamp(),\n        updatedAt: serverTimestamp(),\n      });\n    }\n\n    const senderAnonName = getAnonymousName(user.uid);\n    await addDoc(collection(chatRef, \"messages\"), {\n      senderAnonName,\n      body,\n      createdAt: serverTimestamp(),\n    });\n    setText(\"\");\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-[60vh] text-gray-600\">\n        Loading community...\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"max-w-xl mx-auto p-4\">\n        <div className=\"mb-3 text-red-600\">{error}</div>\n        <button className=\"px-3 py-2 bg-blue-600 text-white rounded\" onClick={() => location.reload()}>\n          Retry\n        </button>\n      </div>\n    );\n  }\n\n  return (\n    <main className=\"max-w-2xl mx-auto p-4 space-y-3\">\n      <div className=\"flex items-center justify-between\">\n        <h1 className=\"text-xl font-semibold\">Anonymous Community</h1>\n        <span className=\"text-sm text-gray-500\">Global Room</span>\n      </div>\n\n      <div\n        ref={scrollerRef}\n        className=\"border rounded p-3 h-[60vh] overflow-auto bg-white\"\n        aria-label=\"Community message history\"\n      >\n        {messages.length === 0 && (\n          <div className=\"text-gray-500\">No messages yet. Say hello to the community!</div>\n        )}\n        {messages.map((m) => (\n          <div key={m.id} className=\"my-2\">\n            <div className=\"text-sm text-gray-700 font-medium\">{m.senderAnonName}</div>\n            <div className=\"inline-block bg-slate-100 rounded px-3 py-2 mt-0.5 max-w-full break-words\">\n              {m.body}\n            </div>\n          </div>\n        ))}\n      </div>\n\n      <div className=\"flex gap-2\">\n        <input\n          className=\"flex-1 border p-2 rounded\"\n          value={text}\n          onChange={(e) => setText(e.target.value)}\n          placeholder=\"Share your thoughtsâ€¦\"\n          aria-label=\"Message input\"\n        />\n        <button\n          onClick={send}\n          className=\"bg-indigo-600 text-white px-4 py-2 rounded\"\n          aria-label=\"Send message\"\n        >\n          Send\n        </button>\n      </div>\n\n      <p className=\"text-xs text-gray-500\">\n        You are posting with an anonymous display name. Please avoid sharing any personal identifying information.\n      </p>\n    </main>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}