{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/saksham/OneDrive/Desktop/web/SafeSpeak/src/components/ResourcesMap.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useRef, useState } from \"react\";\r\nimport { MapContainer, TileLayer, Marker, Popup, Circle, useMap } from \"react-leaflet\";\r\nimport L from \"leaflet\";\r\nimport type { Coords } from \"@/lib/geo\";\r\nimport { formatDistance } from \"@/lib/geo\";\r\n\r\n// Fix for default marker icons in Next.js\r\ndelete (L.Icon.Default.prototype as any)._getIconUrl;\r\nL.Icon.Default.mergeOptions({\r\n  iconRetinaUrl: \"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png\",\r\n  iconUrl: \"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png\",\r\n  shadowUrl: \"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png\",\r\n});\r\n\r\n// Custom pink marker for NGOs\r\nconst ngoIcon = new L.Icon({\r\n  iconUrl: \"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-pink.png\",\r\n  shadowUrl: \"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png\",\r\n  iconSize: [25, 41],\r\n  iconAnchor: [12, 41],\r\n  popupAnchor: [1, -34],\r\n  shadowSize: [41, 41],\r\n});\r\n\r\ntype NgoMapData = {\r\n  id: string;\r\n  name: string;\r\n  lat: number;\r\n  lng: number;\r\n  verified: boolean;\r\n  contact?: string;\r\n  distanceKm?: number;\r\n};\r\n\r\ntype ResourcesMapProps = {\r\n  ngos: NgoMapData[];\r\n  userLocation: Coords | null;\r\n  selectedNgoId?: string | null;\r\n  onMarkerClick?: (ngoId: string) => void;\r\n};\r\n\r\nfunction CaptureMap({ onMap }: { onMap: (map: L.Map) => void }) {\r\n  const map = useMap();\r\n  useEffect(() => {\r\n    onMap(map);\r\n  }, [map, onMap]);\r\n  return null;\r\n}\r\n\r\nexport default function ResourcesMap({ ngos, userLocation, selectedNgoId, onMarkerClick }: ResourcesMapProps) {\r\n  const mapRef = useRef<L.Map | null>(null);\r\n  const markerRefs = useRef<Map<string, L.Marker>>(new Map());\r\n  \r\n  // Get top 5 NGOs based on user location\r\n  const top5Ngos = userLocation\r\n    ? [...ngos].sort((a, b) => (a.distanceKm || 0) - (b.distanceKm || 0)).slice(0, 5)\r\n    : ngos.slice(0, 5);\r\n\r\n  // Center map on user location or default to India\r\n  const center: [number, number] = userLocation\r\n    ? [userLocation.lat, userLocation.lng]\r\n    : [20.5937, 78.9629]; // Center of India\r\n\r\n  const zoom = userLocation ? 11 : 5;\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      // Cleanup the map on unmount\r\n      if (mapRef.current) {\r\n        try {\r\n          mapRef.current.off();\r\n          mapRef.current.remove();\r\n        } catch (_) {\r\n          // ignore\r\n        }\r\n        mapRef.current = null;\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  // Center and open popup for selected NGO\r\n  useEffect(() => {\r\n    if (selectedNgoId && mapRef.current) {\r\n      const marker = markerRefs.current.get(selectedNgoId);\r\n      const ngo = ngos.find(n => n.id === selectedNgoId);\r\n      if (marker && ngo) {\r\n        mapRef.current.setView([ngo.lat, ngo.lng], 13, { animate: true });\r\n        marker.openPopup();\r\n      }\r\n    }\r\n  }, [selectedNgoId, ngos]);\r\n\r\n  return (\r\n    <div className=\"w-full h-[60vh] rounded-lg overflow-hidden border border-gray-200\">\r\n      <MapContainer\r\n        center={center}\r\n        zoom={zoom}\r\n        scrollWheelZoom={true}\r\n        className=\"w-full h-full\"\r\n      >\r\n        <CaptureMap onMap={(map) => { mapRef.current = map; }} />\r\n      <TileLayer\r\n        attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\r\n        url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\r\n      />\r\n\r\n      {/* User location marker */}\r\n      {userLocation && (\r\n        <>\r\n          <Circle\r\n            center={[userLocation.lat, userLocation.lng]}\r\n            radius={100}\r\n            pathOptions={{\r\n              color: \"#3b82f6\",\r\n              fillColor: \"#3b82f6\",\r\n              fillOpacity: 0.4,\r\n            }}\r\n          />\r\n          <Marker position={[userLocation.lat, userLocation.lng]}>\r\n            <Popup>\r\n              <div className=\"text-sm font-medium\">Your location</div>\r\n            </Popup>\r\n          </Marker>\r\n        </>\r\n      )}\r\n\r\n      {/* NGO markers - showing top 5 based on location */}\r\n      {top5Ngos.map((ngo) => (\r\n        <Marker\r\n          key={ngo.id}\r\n          position={[ngo.lat, ngo.lng]}\r\n          icon={ngoIcon}\r\n          ref={(ref) => {\r\n            if (ref) markerRefs.current.set(ngo.id, ref);\r\n            else markerRefs.current.delete(ngo.id);\r\n          }}\r\n          eventHandlers={{\r\n            click: () => {\r\n              if (onMarkerClick) {\r\n                onMarkerClick(ngo.id);\r\n              }\r\n            },\r\n          }}\r\n        >\r\n          <Popup>\r\n            <div className=\"min-w-[200px]\">\r\n              <div className=\"flex items-center gap-2 mb-2\">\r\n                <h3 className=\"font-semibold text-gray-900\">{ngo.name}</h3>\r\n                {ngo.verified && (\r\n                  <span className=\"px-1.5 py-0.5 text-xs font-medium rounded-full bg-emerald-100 text-emerald-800\">\r\n                    ‚úì\r\n                  </span>\r\n                )}\r\n              </div>\r\n              {ngo.distanceKm !== undefined && (\r\n                <p className=\"text-sm text-gray-600 mb-2\">\r\n                  {formatDistance(ngo.distanceKm)} away\r\n                </p>\r\n              )}\r\n              <div className=\"flex gap-2 mt-2\">\r\n                {ngo.contact && (\r\n                  <a\r\n                    href={`tel:${ngo.contact}`}\r\n                    className=\"inline-block px-3 py-1 text-xs font-medium text-blue-700 bg-blue-100 rounded hover:bg-blue-200\"\r\n                  >\r\n                    üìû Call\r\n                  </a>\r\n                )}\r\n                <a\r\n                  href={`https://www.google.com/maps/search/?api=1&query=${ngo.lat},${ngo.lng}`}\r\n                  target=\"_blank\"\r\n                  rel=\"noopener noreferrer\"\r\n                  className=\"inline-block px-3 py-1 text-xs font-medium text-gray-700 bg-gray-100 rounded hover:bg-gray-200\"\r\n                >\r\n                  üó∫Ô∏è Open in Maps\r\n                </a>\r\n              </div>\r\n            </div>\r\n          </Popup>\r\n        </Marker>\r\n      ))}\r\n      </MapContainer>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}