{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/saksham/OneDrive/Desktop/web/SafeSpeak/src/lib/crypto.ts"],"sourcesContent":["export async function genKey() {\r\n  return crypto.subtle.generateKey({ name: \"AES-GCM\", length: 256 }, true, [\"encrypt\", \"decrypt\"]);\r\n}\r\nexport async function exportKeyJwk(key: CryptoKey) {\r\n  return crypto.subtle.exportKey(\"jwk\", key);\r\n}\r\nexport async function importKeyJwk(jwk: JsonWebKey) {\r\n  return crypto.subtle.importKey(\"jwk\", jwk, { name: \"AES-GCM\" }, true, [\"encrypt\", \"decrypt\"]);\r\n}\r\nexport async function encryptBytes(key: CryptoKey, data: ArrayBuffer) {\r\n  const iv = crypto.getRandomValues(new Uint8Array(12));\r\n  const ct = await crypto.subtle.encrypt({ name: \"AES-GCM\", iv }, key, data);\r\n  return { ciphertext: new Uint8Array(ct), iv };\r\n}\r\nexport async function decryptBytes(key: CryptoKey, ciphertext: Uint8Array, iv: Uint8Array) {\r\n  return crypto.subtle.decrypt({ name: \"AES-GCM\", iv }, key, ciphertext);\r\n}"],"names":[],"mappings":";;;;;;;;;;;;AAAO,eAAe;IACpB,OAAO,OAAO,MAAM,CAAC,WAAW,CAAC;QAAE,MAAM;QAAW,QAAQ;IAAI,GAAG,MAAM;QAAC;QAAW;KAAU;AACjG;AACO,eAAe,aAAa,GAAc;IAC/C,OAAO,OAAO,MAAM,CAAC,SAAS,CAAC,OAAO;AACxC;AACO,eAAe,aAAa,GAAe;IAChD,OAAO,OAAO,MAAM,CAAC,SAAS,CAAC,OAAO,KAAK;QAAE,MAAM;IAAU,GAAG,MAAM;QAAC;QAAW;KAAU;AAC9F;AACO,eAAe,aAAa,GAAc,EAAE,IAAiB;IAClE,MAAM,KAAK,OAAO,eAAe,CAAC,IAAI,WAAW;IACjD,MAAM,KAAK,MAAM,OAAO,MAAM,CAAC,OAAO,CAAC;QAAE,MAAM;QAAW;IAAG,GAAG,KAAK;IACrE,OAAO;QAAE,YAAY,IAAI,WAAW;QAAK;IAAG;AAC9C;AACO,eAAe,aAAa,GAAc,EAAE,UAAsB,EAAE,EAAc;IACvF,OAAO,OAAO,MAAM,CAAC,OAAO,CAAC;QAAE,MAAM;QAAW;IAAG,GAAG,KAAK;AAC7D","debugId":null}},
    {"offset": {"line": 60, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/saksham/OneDrive/Desktop/web/SafeSpeak/src/lib/hash.ts"],"sourcesContent":["export async function sha256Hex(buf: ArrayBuffer) {\r\n  const hash = await crypto.subtle.digest(\"SHA-256\", buf);\r\n  return Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2,\"0\")).join(\"\");\r\n}"],"names":[],"mappings":";;;;AAAO,eAAe,UAAU,GAAgB;IAC9C,MAAM,OAAO,MAAM,OAAO,MAAM,CAAC,MAAM,CAAC,WAAW;IACnD,OAAO,MAAM,IAAI,CAAC,IAAI,WAAW,OAAO,GAAG,CAAC,CAAA,IAAK,EAAE,QAAQ,CAAC,IAAI,QAAQ,CAAC,GAAE,MAAM,IAAI,CAAC;AACxF","debugId":null}},
    {"offset": {"line": 75, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/saksham/OneDrive/Desktop/web/SafeSpeak/src/lib/imageBlur.ts"],"sourcesContent":["import * as blazeface from \"@tensorflow-models/blazeface\";\nimport \"@tensorflow/tfjs\";\n\n/**\n * Represents a rectangular region in an image\n */\ntype Rect = { x: number; y: number; width: number; height: number };\n\n/**\n * Converts a File to a Canvas element with optional resizing\n * @param file The image file to convert\n * @param maxSize Maximum dimension (default: 1920)\n * @returns Canvas element with the image\n */\nexport async function fileToCanvas(file: File, maxSize: number = 1920): Promise<HTMLCanvasElement> {\n  if (typeof window === 'undefined') {\n    throw new Error('This function can only run in the browser');\n  }\n\n  const img = new Image();\n  const url = URL.createObjectURL(file);\n  \n  await new Promise<void>((resolve, reject) => {\n    img.onload = () => {\n      URL.revokeObjectURL(url);\n      resolve();\n    };\n    img.onerror = () => {\n      URL.revokeObjectURL(url);\n      reject(new Error('Failed to load image'));\n    };\n    img.src = url;\n  });\n\n  // Calculate new dimensions while maintaining aspect ratio\n  let { width, height } = img;\n  if (width > height && width > maxSize) {\n    height *= maxSize / width;\n    width = maxSize;\n  } else if (height > maxSize) {\n    width *= maxSize / height;\n    height = maxSize;\n  }\n\n  const canvas = document.createElement('canvas');\n  canvas.width = Math.round(width);\n  canvas.height = Math.round(height);\n  \n  const ctx = canvas.getContext('2d');\n  if (!ctx) throw new Error('Could not get canvas context');\n  \n  ctx.imageSmoothingQuality = 'high';\n  ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\n  \n  return canvas;\n}\n\n/**\n * Detects faces in an image using the best available method\n * @param canvas Canvas element containing the image\n * @returns Array of face rectangles\n */\nasync function detectFacesRects(canvas: HTMLCanvasElement): Promise<Rect[]> {\n  if (typeof window === 'undefined') {\n    return [];\n  }\n\n  // Try native FaceDetector API first if available and in secure context\n  const anyWin = window as any;\n  if (anyWin.FaceDetector && window.isSecureContext) {\n    try {\n      const detector = new anyWin.FaceDetector({ \n        fastMode: true, \n        maxDetectedFaces: 10 \n      });\n      const faces = await detector.detect(canvas);\n      return faces.map((f: any) => ({\n        x: Math.max(0, f.boundingBox.x - f.boundingBox.width * 0.2),\n        y: Math.max(0, f.boundingBox.y - f.boundingBox.height * 0.2),\n        width: Math.min(canvas.width - f.boundingBox.x, f.boundingBox.width * 1.4),\n        height: Math.min(canvas.height - f.boundingBox.y, f.boundingBox.height * 1.4)\n      }));\n    } catch (error) {\n      console.warn('FaceDetector API failed, falling back to TensorFlow.js', error);\n    }\n  }\n\n  // Fall back to TensorFlow.js\n  try {\n    // Dynamically import TF.js and BlazeFace to reduce initial bundle size\n    const [tf, blazeface] = await Promise.all([\n      import('@tensorflow/tfjs'),\n      import('@tensorflow-models/blazeface')\n    ]);\n    \n    await tf.ready();\n    await tf.setBackend('webgl');\n    \n    const model = await blazeface.load();\n    const predictions = await model.estimateFaces(canvas, false);\n    \n    return predictions.map(pred => {\n      const [x1, y1] = pred.topLeft;\n      const [x2, y2] = pred.bottomRight;\n      const width = x2 - x1;\n      const height = y2 - y1;\n      \n      return {\n        x: Math.max(0, x1 - width * 0.2),\n        y: Math.max(0, y1 - height * 0.2),\n        width: Math.min(canvas.width - x1, width * 1.4),\n        height: Math.min(canvas.height - y1, height * 1.4)\n      };\n    });\n  } catch (error) {\n    console.error('Face detection failed:', error);\n    return [];\n  }\n}\n\n/**\n * Applies pixelation to a region of a canvas\n * @param ctx Canvas rendering context\n * @param rect Region to pixelate\n * @param scale Pixelation scale (0-1, lower = more pixelated)\n */\nfunction pixelateRegion(\n  ctx: CanvasRenderingContext2D,\n  rect: Rect,\n  scale: number = 0.05\n) {\n  const { x, y, width, height } = rect;\n  const w = Math.max(1, Math.floor(width));\n  const h = Math.max(1, Math.floor(height));\n  \n  const tempCanvas = document.createElement('canvas');\n  tempCanvas.width = Math.max(1, Math.floor(w * scale));\n  tempCanvas.height = Math.max(1, Math.floor(h * scale));\n  \n  const tempCtx = tempCanvas.getContext('2d');\n  if (!tempCtx) return;\n  \n  tempCtx.imageSmoothingEnabled = false;\n  tempCtx.drawImage(\n    ctx.canvas,\n    x, y, w, h,\n    0, 0, tempCanvas.width, tempCanvas.height\n  );\n  \n  ctx.imageSmoothingEnabled = false;\n  ctx.drawImage(\n    tempCanvas,\n    0, 0, tempCanvas.width, tempCanvas.height,\n    x, y, w, h\n  );\n  ctx.imageSmoothingEnabled = true;\n}\n\n/**\n * Blurs faces in an image\n * @param file The image file to process\n * @param opts Options for processing\n * @param opts.pixelateScale Pixelation scale (0-1, lower = more pixelated)\n * @param opts.maxSize Maximum dimension of the output image\n * @returns Blob with the processed image (JPEG format, quality 0.85)\n */\nexport async function blurFaces(\n  file: File,\n  opts: { pixelateScale?: number; maxSize?: number } = {}\n): Promise<Blob> {\n  if (typeof window === 'undefined') {\n    throw new Error('This function can only run in the browser');\n  }\n\n  const { pixelateScale = 0.05, maxSize = 1920 } = opts;\n  \n  try {\n    // Load and resize the image\n    const canvas = await fileToCanvas(file, maxSize);\n    const ctx = canvas.getContext('2d');\n    if (!ctx) throw new Error('Could not get canvas context');\n\n    // Detect faces\n    const faceRects = await detectFacesRects(canvas);\n    \n    // Apply pixelation to each detected face\n    for (const rect of faceRects) {\n      pixelateRegion(ctx, rect, pixelateScale);\n    }\n\n    // Convert to blob with JPEG format and quality 0.85 (strips EXIF data)\n    return new Promise((resolve, reject) => {\n      canvas.toBlob(\n        (blob) => {\n          if (!blob) {\n            reject(new Error('Failed to create blob from canvas'));\n            return;\n          }\n          resolve(blob);\n        },\n        'image/jpeg',\n        0.85\n      );\n    });\n  } catch (error) {\n    console.error('Error processing image:', error);\n    throw new Error(`Failed to process image: ${error instanceof Error ? error.message : String(error)}`);\n  }\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 228, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/saksham/OneDrive/Desktop/web/SafeSpeak/src/lib/supabaseUpload.ts"],"sourcesContent":["/**\n * Client helper utilities for Supabase signed uploads.\n * Expected path format: \"evidence/<uid>/<reportId>/file.bin\".\n */\n\nconst SIGN_UPLOAD_ENDPOINT = \"/api/supabase/sign-upload\";\nconst PATH_PREFIX = \"evidence/\";\nconst MIN_PATH_LENGTH = 8;\nconst MAX_PATH_LENGTH = 300;\n\ntype SignedUploadResponse = {\n  signedUrl: string;\n  path: string;\n  expiresAt: number;\n};\n\ntype UploadOptions = {\n  expiresIn?: number;\n  upsert?: boolean;\n};\n\nfunction ensureValidPath(path: string): string {\n  const trimmed = path.trim();\n\n  if (!trimmed.startsWith(PATH_PREFIX)) {\n    throw new Error('Upload path must start with \"evidence/\".');\n  }\n\n  if (trimmed.length < MIN_PATH_LENGTH || trimmed.length > MAX_PATH_LENGTH) {\n    throw new Error(\"Upload path length must be between 8 and 300 characters.\");\n  }\n\n  return trimmed;\n}\n\nfunction assertSignedUploadResponse(payload: unknown): SignedUploadResponse {\n  if (\n    typeof payload === \"object\" &&\n    payload !== null &&\n    typeof (payload as { signedUrl?: unknown }).signedUrl === \"string\" &&\n    typeof (payload as { path?: unknown }).path === \"string\" &&\n    typeof (payload as { expiresAt?: unknown }).expiresAt === \"number\"\n  ) {\n    return payload as SignedUploadResponse;\n  }\n\n  throw new Error(\"Unexpected response payload from upload signer.\");\n}\n\n/**\n * Fetches a signed upload URL for the given path.\n */\nexport async function getSignedUploadUrl(\n  path: string,\n  opts: UploadOptions = {},\n): Promise<SignedUploadResponse> {\n  const safePath = ensureValidPath(path);\n\n  const response = await fetch(SIGN_UPLOAD_ENDPOINT, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n    },\n    body: JSON.stringify({ path: safePath, ...opts }),\n  });\n\n  if (!response.ok) {\n    const errorText = await extractErrorText(response);\n    throw new Error(`Failed to fetch signed upload URL: ${errorText}`);\n  }\n\n  const json = (await response.json()) as unknown;\n  return assertSignedUploadResponse(json);\n}\n\n/**\n * Uploads binary data directly to the supplied signed URL.\n */\nexport async function putToSignedUrl(\n  signedUrl: string,\n  data: Blob | ArrayBuffer | Uint8Array,\n): Promise<{ ok: true }> {\n  const body = normalizeBody(data);\n\n  const response = await fetch(signedUrl, {\n    method: \"PUT\",\n    headers: {\n      \"Content-Type\": \"application/octet-stream\",\n      \"x-upsert\": \"true\",\n    },\n    body,\n  });\n\n  if (!response.ok) {\n    const errorText = await extractErrorText(response);\n    throw new Error(`Failed to upload to signed URL: ${errorText}`);\n  }\n\n  return { ok: true } as const;\n}\n\n/**\n * Convenience helper that obtains a signed upload URL and uploads the provided blob.\n */\nexport async function uploadCiphertextViaSupabase(\n  path: string,\n  blob: Blob,\n): Promise<{ path: string; expiresAt: number }> {\n  const { signedUrl, expiresAt } = await getSignedUploadUrl(path);\n  await putToSignedUrl(signedUrl, blob);\n  return { path, expiresAt };\n}\n\nasync function extractErrorText(response: Response): Promise<string> {\n  try {\n    const payload = (await response.json()) as unknown;\n    if (typeof payload === \"object\" && payload !== null) {\n      const errorValue = (payload as { error?: unknown }).error;\n      if (typeof errorValue === \"string\" && errorValue.trim()) {\n        return `${response.status} ${response.statusText}: ${errorValue}`;\n      }\n    }\n  } catch {\n    // Ignore JSON parsing errors; fall back to text.\n  }\n\n  try {\n    const text = await response.text();\n    if (text.trim()) {\n      return `${response.status} ${response.statusText}: ${text}`;\n    }\n  } catch {\n    // Ignore text parsing errors.\n  }\n\n  return `${response.status} ${response.statusText}`;\n}\n\nfunction normalizeBody(data: Blob | ArrayBuffer | Uint8Array): BodyInit {\n  if (data instanceof Blob) {\n    return data;\n  }\n\n  if (data instanceof ArrayBuffer) {\n    return data;\n  }\n\n  if (data instanceof Uint8Array) {\n    return data.buffer.slice(data.byteOffset, data.byteOffset + data.byteLength);\n  }\n\n  throw new Error(\"Unsupported data type for upload body.\");\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 345, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/saksham/OneDrive/Desktop/web/SafeSpeak/src/app/report/new/page.tsx"],"sourcesContent":["\"use client\";\nimport { useEffect, useState, useCallback } from \"react\";\nimport { useRouter } from \"next/navigation\";\n\n// Helper function to safely convert ArrayBufferLike to ArrayBuffer\nfunction toArrayBuffer(bufferLike: ArrayBuffer | SharedArrayBuffer | ArrayBufferView): ArrayBuffer {\n  if (bufferLike instanceof ArrayBuffer) {\n    return bufferLike;\n  }\n  \n  if ('buffer' in bufferLike) {\n    return bufferLike.buffer.slice(\n      bufferLike.byteOffset,\n      bufferLike.byteOffset + bufferLike.byteLength\n    );\n  }\n  \n  // For SharedArrayBuffer, create a new ArrayBuffer and copy the data\n  const newBuffer = new ArrayBuffer(bufferLike.byteLength);\n  new Uint8Array(newBuffer).set(new Uint8Array(bufferLike));\n  return newBuffer;\n}\nimport { ensureAnon, auth, db } from \"@/lib/firebase\";\nimport { doc, setDoc, serverTimestamp } from \"firebase/firestore\";\nimport { genKey, encryptBytes, exportKeyJwk } from \"@/lib/crypto\";\nimport { sha256Hex } from \"@/lib/hash\";\nimport { blurFaces, fileToCanvas } from \"@/lib/imageBlur\";\nimport { uploadCiphertextViaSupabase } from \"@/lib/supabaseUpload\";\n\ntype StepId = \"blur\" | \"encrypt\" | \"upload\" | \"classify\" | \"anchor\" | \"save\";\ntype StepStatus = \"idle\" | \"active\" | \"ok\" | \"fail\" | \"skip\";\n\ninterface StepItem {\n  id: StepId;\n  label: string;\n  status: StepStatus;\n  note?: string;\n  error?: string;\n}\n\nconst INITIAL_STEPS: StepItem[] = [\n  { id: \"blur\", label: \"Blurring image\", status: \"idle\" },\n  { id: \"encrypt\", label: \"Encrypting evidence\", status: \"idle\" },\n  { id: \"upload\", label: \"Uploading to storage\", status: \"idle\" },\n  { id: \"classify\", label: \"Classifying report\", status: \"idle\" },\n  { id: \"anchor\", label: \"Anchoring hash\", status: \"idle\" },\n  { id: \"save\", label: \"Saving report\", status: \"idle\" },\n];\n\nexport default function NewReport() {\n  const router = useRouter();\n  const [text, setText] = useState(\"\");\n  const [redacted, setRedacted] = useState(\"\");\n  const [imgFile, setImgFile] = useState<File | null>(null);\n  const [loading, setLoading] = useState(false);\n  const [previewUrl, setPreviewUrl] = useState<string | null>(null);\n  const [recoveryKey, setRecoveryKey] = useState<string | null>(null);\n  const [network, setNetwork] = useState<\"sepolia\" | \"amoy\">(\"sepolia\");\n  const [steps, setSteps] = useState<StepItem[]>(INITIAL_STEPS);\n  const [showRecoveryKey, setShowRecoveryKey] = useState(false);\n  const [compress, setCompress] = useState(true);\n\n  useEffect(() => {\n    ensureAnon();\n  }, []);\n\n  useEffect(() => {\n    if (imgFile) {\n      const url = URL.createObjectURL(imgFile);\n      setPreviewUrl(url);\n      return () => URL.revokeObjectURL(url);\n    }\n  }, [imgFile]);\n\n  const updateStep = useCallback((id: StepId, updates: Partial<StepItem>) => {\n    setSteps(prev => prev.map(step => \n      step.id === id ? { ...step, ...updates } : step\n    ));\n  }, []);\n\n  const startStep = useCallback((id: StepId) => {\n    updateStep(id, { status: \"active\", error: undefined });\n  }, [updateStep]);\n\n  const finishStep = useCallback((id: StepId, note?: string) => {\n    updateStep(id, { status: \"ok\", note });\n  }, [updateStep]);\n\n  const failStep = useCallback((id: StepId, error: string) => {\n    console.error(`[${id.toUpperCase()}] Error:`, error);\n    updateStep(id, { status: \"fail\", error });\n  }, [updateStep]);\n\n  const skipStep = useCallback((id: StepId, note?: string) => {\n    updateStep(id, { status: \"skip\", note });\n  }, [updateStep]);\n\n  const renderStatusIcon = (status: StepStatus) => {\n    switch (status) {\n      case 'active': return <div className=\"w-4 h-4 border-2 border-blue-500 rounded-full border-t-transparent animate-spin\"></div>;\n      case 'ok': return <div className=\"w-4 h-4 bg-green-500 rounded-full flex items-center justify-center text-white text-xs\">✓</div>;\n      case 'fail': return <div className=\"w-4 h-4 bg-red-500 rounded-full flex items-center justify-center text-white text-xs\">✗</div>;\n      case 'skip': return <div className=\"w-4 h-4 bg-gray-300 rounded-full\"></div>;\n      default: return <div className=\"w-4 h-4 border border-gray-300 rounded-full\"></div>;\n    }\n  };\n\n  async function handleRedact() {\n    try {\n      const r = await fetch(\"/api/redact\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ text })\n      });\n      const j = await r.json();\n      if (j.error) throw new Error(j.error);\n      setRedacted(j.redacted || text);\n    } catch (error) {\n      console.error(\"Redaction failed:\", error);\n      alert(\"Failed to redact PII. Please try again.\");\n    }\n  }\n\n  async function onSubmit() {\n    if (!text.trim()) return alert(\"Please enter a description.\");\n    \n    setLoading(true);\n    setSteps(INITIAL_STEPS);\n    setShowRecoveryKey(false);\n    \n    try {\n      const user = auth.currentUser;\n      if (!user) throw new Error(\"User not authenticated\");\n      \n      const reportId = crypto.randomUUID();\n      const basePath = `evidence/${user.uid}/${reportId}`;\n      let processedImageBlob: Blob | null = null;\n      let fileSha256 = \"\";\n      let txHash = \"\";\n      let explorer = network === \"amoy\" \n        ? \"https://amoy.polygonscan.com/tx/\" \n        : \"https://sepolia.etherscan.com/tx/\";\n      \n      // BLUR STEP\n      startStep(\"blur\");\n      console.time(\"[BLUR]\");\n      try {\n        if (imgFile) {\n          try {\n            let sourceFile = imgFile;\n            let compressionNote = '';\n            \n            // Compress image if enabled and it's an image\n            if (compress && imgFile.type.startsWith('image/')) {\n              const canvas = await fileToCanvas(imgFile, 1920);\n              // Create a new compressed file\n              const compressedBlob = await new Promise<Blob>((res) => \n                canvas.toBlob(b => res(b!), \"image/jpeg\", 0.85)\n              );\n              compressionNote = `, compressed to ${canvas.width}x${canvas.height}`;\n              sourceFile = new File([compressedBlob], imgFile.name, { \n                type: 'image/jpeg',\n                lastModified: Date.now()\n              });\n            }\n            \n            processedImageBlob = await blurFaces(sourceFile, { maxSize: 1920 });\n            finishStep(\"blur\", `Faces detected and blurred${compressionNote}`);\n          } catch (blurError) {\n            console.warn(\"Face detection failed, falling back to EXIF strip:\", blurError);\n            const canvas = await fileToCanvas(imgFile, 1920);\n            processedImageBlob = await new Promise(res => \n              canvas.toBlob(b => res(b!), \"image/jpeg\", 0.85)\n            );\n            failStep(\"blur\", `Face detection failed; EXIF stripped only, compressed to ${canvas.width}x${canvas.height}`);\n          }\n        } else {\n          skipStep(\"blur\", \"No image to process\");\n        }\n      } catch (e) {\n        failStep(\"blur\", e instanceof Error ? e.message : \"Unknown error\");\n        throw e;\n      } finally {\n        console.timeEnd(\"[BLUR]\");\n      }\n\n      // ENCRYPT STEP\n      startStep(\"encrypt\");\n      console.time(\"[ENCRYPT]\");\n      let key: CryptoKey;\n      let keyJwk: JsonWebKey;\n      let textEnc: { ciphertext: Uint8Array; iv: Uint8Array };\n      let imgEnc: { ciphertext: Uint8Array; iv: Uint8Array } | null = null;\n\n      try {\n        key = await genKey();\n        keyJwk = await exportKeyJwk(key);\n        setRecoveryKey(JSON.stringify(keyJwk));\n        setShowRecoveryKey(true);\n\n        const source = redacted || text;\n        // Convert text to Uint8Array and ensure we have a proper ArrayBuffer\n        const textBuf = new TextEncoder().encode(source);\n        textEnc = await encryptBytes(key, toArrayBuffer(textBuf));\n\n        if (processedImageBlob) {\n          // Get image as ArrayBuffer and ensure it's a proper ArrayBuffer\n          const imgArrayBuffer = await processedImageBlob.arrayBuffer();\n          imgEnc = await encryptBytes(key, toArrayBuffer(imgArrayBuffer));\n        }\n\n        const note = `text: ${textEnc.ciphertext.length}B${\n          imgEnc ? `, image: ${imgEnc.ciphertext.length}B` : \"\"\n        }`;\n        finishStep(\"encrypt\", note);\n      } catch (e) {\n        failStep(\"encrypt\", e instanceof Error ? e.message : \"Encryption failed\");\n        throw e;\n      } finally {\n        console.timeEnd(\"[ENCRYPT]\");\n      }\n\n      // UPLOAD STEP\n      startStep(\"upload\");\n      console.time(\"[UPLOAD]\");\n      let textPath = '';\n      let imagePath = '';\n      \n      try {\n        // Upload text\n        const textBlob = new Blob([textEnc.ciphertext]);\n        const textResult = await uploadCiphertextViaSupabase(\n          `evidence/${user.uid}/${reportId}/text.bin`,\n          textBlob\n        );\n        textPath = textResult.path;\n        \n        // Upload image if exists\n        if (imgEnc) {\n          const imageBlob = new Blob([imgEnc.ciphertext]);\n          const imageResult = await uploadCiphertextViaSupabase(\n            `evidence/${user.uid}/${reportId}/image.bin`,\n            imageBlob\n          );\n          imagePath = imageResult.path;\n        }\n        \n        const note = `Uploaded ${imgEnc ? 'text and image' : 'text'} to Supabase`;\n        finishStep(\"upload\", note);\n      } catch (e) {\n        const errorMsg = e instanceof Error ? e.message : \"Upload failed\";\n        failStep(\"upload\", errorMsg);\n        throw new Error(`Upload failed: ${errorMsg}`);\n      } finally {\n        console.timeEnd(\"[UPLOAD]\");\n      }\n\n      // Calculate file hash for integrity check\n      const integrityBuf = imgEnc ? imgEnc.ciphertext.buffer : textEnc.ciphertext.buffer;\n      fileSha256 = await sha256Hex(integrityBuf);\n\n      // CLASSIFY STEP (optional)\n      startStep(\"classify\");\n      console.time(\"[CLASSIFY]\");\n      let classification = { tags: [] as string[], severity: 3, urgency: \"medium\", summary: \"\" };\n      \n      try {\n        const source = redacted || text;\n        const cRes = await fetch(\"/api/classify\", {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({ text: source })\n        });\n        \n        if (cRes.ok) {\n          const c = await cRes.json();\n          if (c.tags) {\n            classification = {\n              tags: c.tags || [],\n              severity: c.severity ?? 3,\n              urgency: c.urgency || \"medium\",\n              summary: c.summary || \"\"\n            };\n            finishStep(\"classify\", `Tags: ${c.tags.join(\", \")}`);\n          } else {\n            skipStep(\"classify\", \"No classification data\");\n          }\n        } else {\n          throw new Error(`HTTP ${cRes.status}`);\n        }\n      } catch (e) {\n        const errorMsg = e instanceof Error ? e.message : \"Classification failed\";\n        failStep(\"classify\", errorMsg);\n        console.warn(\"Classification failed, continuing without:\", e);\n      } finally {\n        console.timeEnd(\"[CLASSIFY]\");\n      }\n\n      // ANCHOR STEP (optional)\n      startStep(\"anchor\");\n      console.time(\"[ANCHOR]\");\n      \n      try {\n        const aRes = await fetch(\"/api/anchor\", {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({\n            sha256Hex: fileSha256,\n            network: network === \"amoy\" ? \"amoy\" : undefined\n          })\n        });\n        \n        if (aRes.ok) {\n          const a = await aRes.json();\n          if (a.txHash) {\n            txHash = a.txHash;\n            explorer = a.explorer || explorer;\n            finishStep(\"anchor\", `Tx: ${txHash.slice(0, 10)}…`);\n          } else {\n            skipStep(\"anchor\", \"No transaction hash received\");\n          }\n        } else {\n          throw new Error(`HTTP ${aRes.status}`);\n        }\n      } catch (e) {\n        const errorMsg = e instanceof Error ? e.message : \"Anchoring failed\";\n        failStep(\"anchor\", errorMsg);\n        console.warn(\"Anchoring failed, continuing without:\", e);\n      } finally {\n        console.timeEnd(\"[ANCHOR]\");\n      }\n\n      // SAVE STEP\n      startStep(\"save\");\n      console.time(\"[SAVE]\");\n      \n      try {\n        await setDoc(doc(db, \"reports\", reportId), {\n          ownerUid: user.uid,\n          createdAt: serverTimestamp(),\n          tags: classification.tags,\n          severity: classification.severity,\n          urgency: classification.urgency,\n          summary: classification.summary,\n          textPath,\n          ...(imagePath && { imagePath }),\n          fileSha256,\n          anchorTxHash: txHash,\n          anchorExplorer: explorer,\n          anchorNetwork: network,\n          status: \"new\"\n        });\n        \n        finishStep(\"save\", \"Report saved successfully\");\n        console.timeEnd(\"[SAVE]\");\n        \n        // Navigate to report view after a short delay to show completion\n        setTimeout(() => {\n          router.push(`/report/${reportId}`);\n        }, 1000);\n        \n      } catch (e) {\n        const errorMsg = e instanceof Error ? e.message : \"Failed to save report\";\n        failStep(\"save\", errorMsg);\n        console.timeEnd(\"[SAVE]\");\n        throw e;\n      }\n      \n    } catch (e) {\n      console.error(\"Report submission failed:\", e);\n      alert(`Failed to submit report: ${e instanceof Error ? e.message : 'Unknown error'}`);\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  return (\n    <div className=\"max-w-6xl mx-auto p-6 grid grid-cols-1 lg:grid-cols-3 gap-6\">\n      <div className=\"lg:col-span-2 space-y-4\">\n        <h2 className=\"text-2xl font-bold text-gray-800\">New Report</h2>\n        \n        <div className=\"bg-white rounded-lg shadow p-6 space-y-4\">\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              Describe what happened\n            </label>\n            <textarea\n              value={text}\n              onChange={(e) => setText(e.target.value)}\n              rows={8}\n              className=\"w-full border border-gray-300 rounded-md p-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n              placeholder=\"Describe what happened...\"\n              disabled={loading}\n            />\n          </div>\n          \n          <div className=\"flex flex-wrap gap-3 items-center\">\n            <button\n              onClick={handleRedact}\n              disabled={!text.trim() || loading}\n              className=\"bg-slate-800 text-white px-4 py-2 rounded-md hover:bg-slate-700 disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              Redact PII\n            </button>\n            \n            <label className=\"cursor-pointer bg-white border border-gray-300 rounded-md px-4 py-2 hover:bg-gray-50\">\n              <span className=\"text-sm font-medium\">Add Image</span>\n              <input\n                type=\"file\"\n                accept=\"image/*\"\n                onChange={(e) => setImgFile(e.target.files?.[0] || null)}\n                className=\"hidden\"\n                disabled={loading}\n              />\n            </label>\n            \n            <div className=\"flex items-center space-x-2 ml-auto\">\n              <span className=\"text-sm text-gray-600\">Network:</span>\n              <select\n                value={network}\n                onChange={(e) => setNetwork(e.target.value as any)}\n                className=\"border border-gray-300 rounded-md p-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                disabled={loading}\n              >\n                <option value=\"sepolia\">Sepolia (Ethereum)</option>\n                <option value=\"amoy\">Polygon Amoy</option>\n              </select>\n            </div>\n          </div>\n          \n          {redacted && (\n            <div className=\"p-3 bg-slate-50 rounded-md border border-slate-200\">\n              <h3 className=\"font-medium text-slate-800 mb-1\">Redacted Preview:</h3>\n              <p className=\"whitespace-pre-wrap text-slate-700\">{redacted}</p>\n            </div>\n          )}\n          \n          {previewUrl && (\n            <div className=\"border border-gray-200 rounded-md p-2\">\n              <div className=\"text-sm text-gray-600 mb-1\">Image Preview:</div>\n              <img\n                src={previewUrl}\n                alt=\"Preview\"\n                className=\"max-h-64 max-w-full rounded-md object-contain border border-gray-200\"\n              />\n            </div>\n          )}\n          \n          <div className=\"space-y-3 pt-2\">\n            {imgFile && (\n              <div className=\"flex items-start space-x-2\">\n                <div className=\"flex items-center h-5\">\n                  <input\n                    id=\"compress-toggle\"\n                    type=\"checkbox\"\n                    checked={compress}\n                    onChange={(e) => setCompress(e.target.checked)}\n                    className=\"h-4 w-4 rounded border-gray-300 text-emerald-600 focus:ring-emerald-500\"\n                    disabled={loading}\n                  />\n                </div>\n                <div className=\"text-sm\">\n                  <label htmlFor=\"compress-toggle\" className=\"font-medium text-gray-700\">\n                    Compress large images\n                  </label>\n                  <p className=\"text-xs text-gray-500\">\n                    Resize large images before blur (faster, safer)\n                  </p>\n                </div>\n              </div>\n            )}\n            \n            <button\n              onClick={onSubmit}\n              disabled={loading || !text.trim()}\n              className={`w-full py-3 px-4 rounded-md font-medium ${\n                loading || !text.trim()\n                  ? 'bg-gray-300 cursor-not-allowed'\n                  : 'bg-emerald-600 hover:bg-emerald-700 text-white'\n              }`}\n            >\n              {loading ? 'Submitting...' : 'Submit Report'}\n            </button>\n          </div>\n        </div>\n      </div>\n      \n      <div className=\"lg:col-span-1\">\n        <div className=\"bg-white rounded-lg shadow p-6 sticky top-6\">\n          <h3 className=\"text-lg font-semibold text-gray-800 mb-4\">Status</h3>\n          <div \n            className=\"space-y-3 text-sm\"\n            aria-live=\"polite\"\n            aria-atomic=\"true\"\n          >\n            {steps.map((step) => (\n              <div key={step.id} className=\"flex items-start space-x-2\">\n                <div className=\"mt-0.5\">\n                  {renderStatusIcon(step.status)}\n                </div>\n                <div className=\"flex-1\">\n                  <div className=\"flex justify-between items-start\">\n                    <span className={`font-medium ${\n                      step.status === 'fail' ? 'text-red-600' : 'text-gray-700'\n                    }`}>\n                      {step.label}\n                    </span>\n                    {step.note && (\n                      <span className=\"text-xs text-gray-500 ml-2 whitespace-nowrap\">\n                        {step.note}\n                      </span>\n                    )}\n                  </div>\n                  {step.error && (\n                    <div className=\"mt-1 text-xs text-red-500 bg-red-50 p-2 rounded\">\n                      {step.error}\n                    </div>\n                  )}\n                </div>\n              </div>\n            ))}\n          </div>\n          \n          {showRecoveryKey && recoveryKey && (\n            <div className=\"mt-6 pt-4 border-t border-gray-200\">\n              <div className=\"flex justify-between items-center mb-2\">\n                <h4 className=\"font-medium text-gray-800\">Recovery Key</h4>\n                <button\n                  onClick={() => navigator.clipboard.writeText(recoveryKey)}\n                  className=\"text-xs text-blue-600 hover:text-blue-800\"\n                >\n                  Copy\n                </button>\n              </div>\n              <div className=\"relative\">\n                <textarea\n                  readOnly\n                  value={recoveryKey}\n                  className=\"w-full h-32 p-2 text-xs font-mono bg-gray-50 border border-gray-200 rounded-md focus:outline-none\"\n                />\n                <div className=\"absolute top-2 right-2 text-xs text-gray-500\">\n                  {recoveryKey.length} chars\n                </div>\n              </div>\n              <p className=\"mt-1 text-xs text-gray-500\">\n                Save this key securely. You'll need it to access your report.\n              </p>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}"],"names":[],"mappings":";;;;;AACA;AACA;AAoBA;AACA;AAAA;AACA;AACA;AACA;AACA;;;AA3BA;;;AAIA,mEAAmE;AACnE,SAAS,cAAc,UAA6D;IAClF,IAAI,sBAAsB,aAAa;QACrC,OAAO;IACT;IAEA,IAAI,YAAY,YAAY;QAC1B,OAAO,WAAW,MAAM,CAAC,KAAK,CAC5B,WAAW,UAAU,EACrB,WAAW,UAAU,GAAG,WAAW,UAAU;IAEjD;IAEA,oEAAoE;IACpE,MAAM,YAAY,IAAI,YAAY,WAAW,UAAU;IACvD,IAAI,WAAW,WAAW,GAAG,CAAC,IAAI,WAAW;IAC7C,OAAO;AACT;;;;;;;AAmBA,MAAM,gBAA4B;IAChC;QAAE,IAAI;QAAQ,OAAO;QAAkB,QAAQ;IAAO;IACtD;QAAE,IAAI;QAAW,OAAO;QAAuB,QAAQ;IAAO;IAC9D;QAAE,IAAI;QAAU,OAAO;QAAwB,QAAQ;IAAO;IAC9D;QAAE,IAAI;QAAY,OAAO;QAAsB,QAAQ;IAAO;IAC9D;QAAE,IAAI;QAAU,OAAO;QAAkB,QAAQ;IAAO;IACxD;QAAE,IAAI;QAAQ,OAAO;QAAiB,QAAQ;IAAO;CACtD;AAEc,SAAS;;IACtB,MAAM,SAAS,IAAA,6LAAS;IACxB,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,oNAAQ,EAAC;IACjC,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,oNAAQ,EAAC;IACzC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,oNAAQ,EAAc;IACpD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,oNAAQ,EAAC;IACvC,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,oNAAQ,EAAgB;IAC5D,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,oNAAQ,EAAgB;IAC9D,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,oNAAQ,EAAqB;IAC3D,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,oNAAQ,EAAa;IAC/C,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,oNAAQ,EAAC;IACvD,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,oNAAQ,EAAC;IAEzC,IAAA,qNAAS;+BAAC;YACR,IAAA,kLAAU;QACZ;8BAAG,EAAE;IAEL,IAAA,qNAAS;+BAAC;YACR,IAAI,SAAS;gBACX,MAAM,MAAM,IAAI,eAAe,CAAC;gBAChC,cAAc;gBACd;2CAAO,IAAM,IAAI,eAAe,CAAC;;YACnC;QACF;8BAAG;QAAC;KAAQ;IAEZ,MAAM,aAAa,IAAA,uNAAW;6CAAC,CAAC,IAAY;YAC1C;qDAAS,CAAA,OAAQ,KAAK,GAAG;6DAAC,CAAA,OACxB,KAAK,EAAE,KAAK,KAAK;gCAAE,GAAG,IAAI;gCAAE,GAAG,OAAO;4BAAC,IAAI;;;QAE/C;4CAAG,EAAE;IAEL,MAAM,YAAY,IAAA,uNAAW;4CAAC,CAAC;YAC7B,WAAW,IAAI;gBAAE,QAAQ;gBAAU,OAAO;YAAU;QACtD;2CAAG;QAAC;KAAW;IAEf,MAAM,aAAa,IAAA,uNAAW;6CAAC,CAAC,IAAY;YAC1C,WAAW,IAAI;gBAAE,QAAQ;gBAAM;YAAK;QACtC;4CAAG;QAAC;KAAW;IAEf,MAAM,WAAW,IAAA,uNAAW;2CAAC,CAAC,IAAY;YACxC,QAAQ,KAAK,CAAC,CAAC,CAAC,EAAE,GAAG,WAAW,GAAG,QAAQ,CAAC,EAAE;YAC9C,WAAW,IAAI;gBAAE,QAAQ;gBAAQ;YAAM;QACzC;0CAAG;QAAC;KAAW;IAEf,MAAM,WAAW,IAAA,uNAAW;2CAAC,CAAC,IAAY;YACxC,WAAW,IAAI;gBAAE,QAAQ;gBAAQ;YAAK;QACxC;0CAAG;QAAC;KAAW;IAEf,MAAM,mBAAmB,CAAC;QACxB,OAAQ;YACN,KAAK;gBAAU,qBAAO,wOAAC;oBAAI,WAAU;;;;;;YACrC,KAAK;gBAAM,qBAAO,wOAAC;oBAAI,WAAU;8BAAwF;;;;;;YACzH,KAAK;gBAAQ,qBAAO,wOAAC;oBAAI,WAAU;8BAAsF;;;;;;YACzH,KAAK;gBAAQ,qBAAO,wOAAC;oBAAI,WAAU;;;;;;YACnC;gBAAS,qBAAO,wOAAC;oBAAI,WAAU;;;;;;QACjC;IACF;IAEA,eAAe;QACb,IAAI;YACF,MAAM,IAAI,MAAM,MAAM,eAAe;gBACnC,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9C,MAAM,KAAK,SAAS,CAAC;oBAAE;gBAAK;YAC9B;YACA,MAAM,IAAI,MAAM,EAAE,IAAI;YACtB,IAAI,EAAE,KAAK,EAAE,MAAM,IAAI,MAAM,EAAE,KAAK;YACpC,YAAY,EAAE,QAAQ,IAAI;QAC5B,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,qBAAqB;YACnC,MAAM;QACR;IACF;IAEA,eAAe;QACb,IAAI,CAAC,KAAK,IAAI,IAAI,OAAO,MAAM;QAE/B,WAAW;QACX,SAAS;QACT,mBAAmB;QAEnB,IAAI;YACF,MAAM,OAAO,4KAAI,CAAC,WAAW;YAC7B,IAAI,CAAC,MAAM,MAAM,IAAI,MAAM;YAE3B,MAAM,WAAW,OAAO,UAAU;YAClC,MAAM,WAAW,CAAC,SAAS,EAAE,KAAK,GAAG,CAAC,CAAC,EAAE,UAAU;YACnD,IAAI,qBAAkC;YACtC,IAAI,aAAa;YACjB,IAAI,SAAS;YACb,IAAI,WAAW,YAAY,SACvB,qCACA;YAEJ,YAAY;YACZ,UAAU;YACV,QAAQ,IAAI,CAAC;YACb,IAAI;gBACF,IAAI,SAAS;oBACX,IAAI;wBACF,IAAI,aAAa;wBACjB,IAAI,kBAAkB;wBAEtB,8CAA8C;wBAC9C,IAAI,YAAY,QAAQ,IAAI,CAAC,UAAU,CAAC,WAAW;4BACjD,MAAM,SAAS,MAAM,IAAA,qLAAY,EAAC,SAAS;4BAC3C,+BAA+B;4BAC/B,MAAM,iBAAiB,MAAM,IAAI,QAAc,CAAC,MAC9C,OAAO,MAAM,CAAC,CAAA,IAAK,IAAI,IAAK,cAAc;4BAE5C,kBAAkB,CAAC,gBAAgB,EAAE,OAAO,KAAK,CAAC,CAAC,EAAE,OAAO,MAAM,EAAE;4BACpE,aAAa,IAAI,KAAK;gCAAC;6BAAe,EAAE,QAAQ,IAAI,EAAE;gCACpD,MAAM;gCACN,cAAc,KAAK,GAAG;4BACxB;wBACF;wBAEA,qBAAqB,MAAM,IAAA,kLAAS,EAAC,YAAY;4BAAE,SAAS;wBAAK;wBACjE,WAAW,QAAQ,CAAC,0BAA0B,EAAE,iBAAiB;oBACnE,EAAE,OAAO,WAAW;wBAClB,QAAQ,IAAI,CAAC,sDAAsD;wBACnE,MAAM,SAAS,MAAM,IAAA,qLAAY,EAAC,SAAS;wBAC3C,qBAAqB,MAAM,IAAI,QAAQ,CAAA,MACrC,OAAO,MAAM,CAAC,CAAA,IAAK,IAAI,IAAK,cAAc;wBAE5C,SAAS,QAAQ,CAAC,yDAAyD,EAAE,OAAO,KAAK,CAAC,CAAC,EAAE,OAAO,MAAM,EAAE;oBAC9G;gBACF,OAAO;oBACL,SAAS,QAAQ;gBACnB;YACF,EAAE,OAAO,GAAG;gBACV,SAAS,QAAQ,aAAa,QAAQ,EAAE,OAAO,GAAG;gBAClD,MAAM;YACR,SAAU;gBACR,QAAQ,OAAO,CAAC;YAClB;YAEA,eAAe;YACf,UAAU;YACV,QAAQ,IAAI,CAAC;YACb,IAAI;YACJ,IAAI;YACJ,IAAI;YACJ,IAAI,SAA4D;YAEhE,IAAI;gBACF,MAAM,MAAM,IAAA,4KAAM;gBAClB,SAAS,MAAM,IAAA,kLAAY,EAAC;gBAC5B,eAAe,KAAK,SAAS,CAAC;gBAC9B,mBAAmB;gBAEnB,MAAM,SAAS,YAAY;gBAC3B,qEAAqE;gBACrE,MAAM,UAAU,IAAI,cAAc,MAAM,CAAC;gBACzC,UAAU,MAAM,IAAA,kLAAY,EAAC,KAAK,cAAc;gBAEhD,IAAI,oBAAoB;oBACtB,gEAAgE;oBAChE,MAAM,iBAAiB,MAAM,mBAAmB,WAAW;oBAC3D,SAAS,MAAM,IAAA,kLAAY,EAAC,KAAK,cAAc;gBACjD;gBAEA,MAAM,OAAO,CAAC,MAAM,EAAE,QAAQ,UAAU,CAAC,MAAM,CAAC,CAAC,EAC/C,SAAS,CAAC,SAAS,EAAE,OAAO,UAAU,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,IACnD;gBACF,WAAW,WAAW;YACxB,EAAE,OAAO,GAAG;gBACV,SAAS,WAAW,aAAa,QAAQ,EAAE,OAAO,GAAG;gBACrD,MAAM;YACR,SAAU;gBACR,QAAQ,OAAO,CAAC;YAClB;YAEA,cAAc;YACd,UAAU;YACV,QAAQ,IAAI,CAAC;YACb,IAAI,WAAW;YACf,IAAI,YAAY;YAEhB,IAAI;gBACF,cAAc;gBACd,MAAM,WAAW,IAAI,KAAK;oBAAC,QAAQ,UAAU;iBAAC;gBAC9C,MAAM,aAAa,MAAM,IAAA,yMAA2B,EAClD,CAAC,SAAS,EAAE,KAAK,GAAG,CAAC,CAAC,EAAE,SAAS,SAAS,CAAC,EAC3C;gBAEF,WAAW,WAAW,IAAI;gBAE1B,yBAAyB;gBACzB,IAAI,QAAQ;oBACV,MAAM,YAAY,IAAI,KAAK;wBAAC,OAAO,UAAU;qBAAC;oBAC9C,MAAM,cAAc,MAAM,IAAA,yMAA2B,EACnD,CAAC,SAAS,EAAE,KAAK,GAAG,CAAC,CAAC,EAAE,SAAS,UAAU,CAAC,EAC5C;oBAEF,YAAY,YAAY,IAAI;gBAC9B;gBAEA,MAAM,OAAO,CAAC,SAAS,EAAE,SAAS,mBAAmB,OAAO,YAAY,CAAC;gBACzE,WAAW,UAAU;YACvB,EAAE,OAAO,GAAG;gBACV,MAAM,WAAW,aAAa,QAAQ,EAAE,OAAO,GAAG;gBAClD,SAAS,UAAU;gBACnB,MAAM,IAAI,MAAM,CAAC,eAAe,EAAE,UAAU;YAC9C,SAAU;gBACR,QAAQ,OAAO,CAAC;YAClB;YAEA,0CAA0C;YAC1C,MAAM,eAAe,SAAS,OAAO,UAAU,CAAC,MAAM,GAAG,QAAQ,UAAU,CAAC,MAAM;YAClF,aAAa,MAAM,IAAA,6KAAS,EAAC;YAE7B,2BAA2B;YAC3B,UAAU;YACV,QAAQ,IAAI,CAAC;YACb,IAAI,iBAAiB;gBAAE,MAAM,EAAE;gBAAc,UAAU;gBAAG,SAAS;gBAAU,SAAS;YAAG;YAEzF,IAAI;gBACF,MAAM,SAAS,YAAY;gBAC3B,MAAM,OAAO,MAAM,MAAM,iBAAiB;oBACxC,QAAQ;oBACR,SAAS;wBAAE,gBAAgB;oBAAmB;oBAC9C,MAAM,KAAK,SAAS,CAAC;wBAAE,MAAM;oBAAO;gBACtC;gBAEA,IAAI,KAAK,EAAE,EAAE;oBACX,MAAM,IAAI,MAAM,KAAK,IAAI;oBACzB,IAAI,EAAE,IAAI,EAAE;wBACV,iBAAiB;4BACf,MAAM,EAAE,IAAI,IAAI,EAAE;4BAClB,UAAU,EAAE,QAAQ,IAAI;4BACxB,SAAS,EAAE,OAAO,IAAI;4BACtB,SAAS,EAAE,OAAO,IAAI;wBACxB;wBACA,WAAW,YAAY,CAAC,MAAM,EAAE,EAAE,IAAI,CAAC,IAAI,CAAC,OAAO;oBACrD,OAAO;wBACL,SAAS,YAAY;oBACvB;gBACF,OAAO;oBACL,MAAM,IAAI,MAAM,CAAC,KAAK,EAAE,KAAK,MAAM,EAAE;gBACvC;YACF,EAAE,OAAO,GAAG;gBACV,MAAM,WAAW,aAAa,QAAQ,EAAE,OAAO,GAAG;gBAClD,SAAS,YAAY;gBACrB,QAAQ,IAAI,CAAC,8CAA8C;YAC7D,SAAU;gBACR,QAAQ,OAAO,CAAC;YAClB;YAEA,yBAAyB;YACzB,UAAU;YACV,QAAQ,IAAI,CAAC;YAEb,IAAI;gBACF,MAAM,OAAO,MAAM,MAAM,eAAe;oBACtC,QAAQ;oBACR,SAAS;wBAAE,gBAAgB;oBAAmB;oBAC9C,MAAM,KAAK,SAAS,CAAC;wBACnB,WAAW;wBACX,SAAS,YAAY,SAAS,SAAS;oBACzC;gBACF;gBAEA,IAAI,KAAK,EAAE,EAAE;oBACX,MAAM,IAAI,MAAM,KAAK,IAAI;oBACzB,IAAI,EAAE,MAAM,EAAE;wBACZ,SAAS,EAAE,MAAM;wBACjB,WAAW,EAAE,QAAQ,IAAI;wBACzB,WAAW,UAAU,CAAC,IAAI,EAAE,OAAO,KAAK,CAAC,GAAG,IAAI,CAAC,CAAC;oBACpD,OAAO;wBACL,SAAS,UAAU;oBACrB;gBACF,OAAO;oBACL,MAAM,IAAI,MAAM,CAAC,KAAK,EAAE,KAAK,MAAM,EAAE;gBACvC;YACF,EAAE,OAAO,GAAG;gBACV,MAAM,WAAW,aAAa,QAAQ,EAAE,OAAO,GAAG;gBAClD,SAAS,UAAU;gBACnB,QAAQ,IAAI,CAAC,yCAAyC;YACxD,SAAU;gBACR,QAAQ,OAAO,CAAC;YAClB;YAEA,YAAY;YACZ,UAAU;YACV,QAAQ,IAAI,CAAC;YAEb,IAAI;gBACF,MAAM,IAAA,uNAAM,EAAC,IAAA,oNAAG,EAAC,0KAAE,EAAE,WAAW,WAAW;oBACzC,UAAU,KAAK,GAAG;oBAClB,WAAW,IAAA,gOAAe;oBAC1B,MAAM,eAAe,IAAI;oBACzB,UAAU,eAAe,QAAQ;oBACjC,SAAS,eAAe,OAAO;oBAC/B,SAAS,eAAe,OAAO;oBAC/B;oBACA,GAAI,aAAa;wBAAE;oBAAU,CAAC;oBAC9B;oBACA,cAAc;oBACd,gBAAgB;oBAChB,eAAe;oBACf,QAAQ;gBACV;gBAEA,WAAW,QAAQ;gBACnB,QAAQ,OAAO,CAAC;gBAEhB,iEAAiE;gBACjE,WAAW;oBACT,OAAO,IAAI,CAAC,CAAC,QAAQ,EAAE,UAAU;gBACnC,GAAG;YAEL,EAAE,OAAO,GAAG;gBACV,MAAM,WAAW,aAAa,QAAQ,EAAE,OAAO,GAAG;gBAClD,SAAS,QAAQ;gBACjB,QAAQ,OAAO,CAAC;gBAChB,MAAM;YACR;QAEF,EAAE,OAAO,GAAG;YACV,QAAQ,KAAK,CAAC,6BAA6B;YAC3C,MAAM,CAAC,yBAAyB,EAAE,aAAa,QAAQ,EAAE,OAAO,GAAG,iBAAiB;QACtF,SAAU;YACR,WAAW;QACb;IACF;IAEA,qBACE,wOAAC;QAAI,WAAU;;0BACb,wOAAC;gBAAI,WAAU;;kCACb,wOAAC;wBAAG,WAAU;kCAAmC;;;;;;kCAEjD,wOAAC;wBAAI,WAAU;;0CACb,wOAAC;;kDACC,wOAAC;wCAAM,WAAU;kDAA+C;;;;;;kDAGhE,wOAAC;wCACC,OAAO;wCACP,UAAU,CAAC,IAAM,QAAQ,EAAE,MAAM,CAAC,KAAK;wCACvC,MAAM;wCACN,WAAU;wCACV,aAAY;wCACZ,UAAU;;;;;;;;;;;;0CAId,wOAAC;gCAAI,WAAU;;kDACb,wOAAC;wCACC,SAAS;wCACT,UAAU,CAAC,KAAK,IAAI,MAAM;wCAC1B,WAAU;kDACX;;;;;;kDAID,wOAAC;wCAAM,WAAU;;0DACf,wOAAC;gDAAK,WAAU;0DAAsB;;;;;;0DACtC,wOAAC;gDACC,MAAK;gDACL,QAAO;gDACP,UAAU,CAAC,IAAM,WAAW,EAAE,MAAM,CAAC,KAAK,EAAE,CAAC,EAAE,IAAI;gDACnD,WAAU;gDACV,UAAU;;;;;;;;;;;;kDAId,wOAAC;wCAAI,WAAU;;0DACb,wOAAC;gDAAK,WAAU;0DAAwB;;;;;;0DACxC,wOAAC;gDACC,OAAO;gDACP,UAAU,CAAC,IAAM,WAAW,EAAE,MAAM,CAAC,KAAK;gDAC1C,WAAU;gDACV,UAAU;;kEAEV,wOAAC;wDAAO,OAAM;kEAAU;;;;;;kEACxB,wOAAC;wDAAO,OAAM;kEAAO;;;;;;;;;;;;;;;;;;;;;;;;4BAK1B,0BACC,wOAAC;gCAAI,WAAU;;kDACb,wOAAC;wCAAG,WAAU;kDAAkC;;;;;;kDAChD,wOAAC;wCAAE,WAAU;kDAAsC;;;;;;;;;;;;4BAItD,4BACC,wOAAC;gCAAI,WAAU;;kDACb,wOAAC;wCAAI,WAAU;kDAA6B;;;;;;kDAC5C,wOAAC;wCACC,KAAK;wCACL,KAAI;wCACJ,WAAU;;;;;;;;;;;;0CAKhB,wOAAC;gCAAI,WAAU;;oCACZ,yBACC,wOAAC;wCAAI,WAAU;;0DACb,wOAAC;gDAAI,WAAU;0DACb,cAAA,wOAAC;oDACC,IAAG;oDACH,MAAK;oDACL,SAAS;oDACT,UAAU,CAAC,IAAM,YAAY,EAAE,MAAM,CAAC,OAAO;oDAC7C,WAAU;oDACV,UAAU;;;;;;;;;;;0DAGd,wOAAC;gDAAI,WAAU;;kEACb,wOAAC;wDAAM,SAAQ;wDAAkB,WAAU;kEAA4B;;;;;;kEAGvE,wOAAC;wDAAE,WAAU;kEAAwB;;;;;;;;;;;;;;;;;;kDAO3C,wOAAC;wCACC,SAAS;wCACT,UAAU,WAAW,CAAC,KAAK,IAAI;wCAC/B,WAAW,CAAC,wCAAwC,EAClD,WAAW,CAAC,KAAK,IAAI,KACjB,mCACA,kDACJ;kDAED,UAAU,kBAAkB;;;;;;;;;;;;;;;;;;;;;;;;0BAMrC,wOAAC;gBAAI,WAAU;0BACb,cAAA,wOAAC;oBAAI,WAAU;;sCACb,wOAAC;4BAAG,WAAU;sCAA2C;;;;;;sCACzD,wOAAC;4BACC,WAAU;4BACV,aAAU;4BACV,eAAY;sCAEX,MAAM,GAAG,CAAC,CAAC,qBACV,wOAAC;oCAAkB,WAAU;;sDAC3B,wOAAC;4CAAI,WAAU;sDACZ,iBAAiB,KAAK,MAAM;;;;;;sDAE/B,wOAAC;4CAAI,WAAU;;8DACb,wOAAC;oDAAI,WAAU;;sEACb,wOAAC;4DAAK,WAAW,CAAC,YAAY,EAC5B,KAAK,MAAM,KAAK,SAAS,iBAAiB,iBAC1C;sEACC,KAAK,KAAK;;;;;;wDAEZ,KAAK,IAAI,kBACR,wOAAC;4DAAK,WAAU;sEACb,KAAK,IAAI;;;;;;;;;;;;gDAIf,KAAK,KAAK,kBACT,wOAAC;oDAAI,WAAU;8DACZ,KAAK,KAAK;;;;;;;;;;;;;mCAnBT,KAAK,EAAE;;;;;;;;;;wBA2BpB,mBAAmB,6BAClB,wOAAC;4BAAI,WAAU;;8CACb,wOAAC;oCAAI,WAAU;;sDACb,wOAAC;4CAAG,WAAU;sDAA4B;;;;;;sDAC1C,wOAAC;4CACC,SAAS,IAAM,UAAU,SAAS,CAAC,SAAS,CAAC;4CAC7C,WAAU;sDACX;;;;;;;;;;;;8CAIH,wOAAC;oCAAI,WAAU;;sDACb,wOAAC;4CACC,QAAQ;4CACR,OAAO;4CACP,WAAU;;;;;;sDAEZ,wOAAC;4CAAI,WAAU;;gDACZ,YAAY,MAAM;gDAAC;;;;;;;;;;;;;8CAGxB,wOAAC;oCAAE,WAAU;8CAA6B;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AASxD;GAxfwB;;QACP,6LAAS;;;KADF","debugId":null}}]
}